<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="ISO-8859-1">
	<title>Post</title>
	<link href="../css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet" />
</head>

	<body>

	<div class="container">
	<nav class="navbar navbar-expand-sm bg-light fixed-top">

		<a href="/" class="navbar-brand">Home</a>

		<ul class="nav nav-pills">
			<li class="nav-item">
				<a class="nav-link" href="/posts">All Posts</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/posts/furniture">Furniture</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/posts/jewelry">Jewelry</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/posts/clothing">Clothing</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" th:if="${username.equals(post.creator.username)}" sec:authorize="isAuthenticated()" >New Post</a>
			</li>
		</ul>

		<form class="form-inline" action="/action_page.php">
			<input class="form-control mr-sm-2" type="text" placeholder="Search">
			<button class="btn btn-success" type="submit">Search</button>
		</form>

	</nav>
	</div>

	<div class = "jumbotron d-flex justify-content-center" style="margin-top:80px;">
	<h1 th:text="${post.title}" ></h1>

	</div>

		<!--To display content of page-->
		<div class="container-body">
			<div class="date">
				<h4><i>Posted by</i></h4>
				<h3 class="card-subtitle mb-2 text-muted" th:text="${post.creator.username}"></h3>
        </span>
			</div>
			<p class="content" th:utext="${post.story}">Post content</p>
		</div>

	<div class="container-body" sec:authorize="isAuthenticated()" id="editArea">
	<form method="post" th:action="@{/posts/view/editpost_{id}(id=${post.id})}" th:object="${post}">
		<label for="postTitle">Post title:</label>
		<input type="text" id="postTitle" name="postTitle" th:field="${post.title}">
		<br><br>
		<textarea id="postToForum" name="postToForum" rows="10" cols="50" th:field="${post.story}">

			  </textarea>
		<br><br>
		<br>
		<label for="itemName">Item:</label>
		<input type="text" id="itemName" name="itemName" th:field="*{item.name}" required>

		<label for="itemCategory">Category:</label>
		<select id="itemCategory" name="itemCategory" th:field="*{item.category}">
		  	
			 <option th:each="category: ${categories}"th:value="${category}" th:text="${category}"></option>
		
		</select>
		<br>
		<label for="tag">Tag</label>
		<input type="text" id="tag" name="tag" th:object="${tag}">
		<button name="addTag">Add Tag</button>
		
		<fieldset id="tags">
			<div th:each="tag, stat: ${post.tags}">
				<input type="hidden" th:field="${post.tags[__${stat.index}__]}">
				<div th:text="${tag}"></div>
			</div>
		</fieldset>
		<br>
		<button onclick="goBack()">Cancel</button>
		<button th:formaction="@{/posts/view/deletepost_{id}(id=${post.id})}">Delete</button>
		<input type="submit" value="Submit">
	</form>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		function goBack(){
			window.history.back();
			return false;
		}

		function showEdit()
		{
			if (document.getElementById("greenBoxComputer").style.display !== "none")
			{
				document.getElementById("greenBoxComputer").style.display = "none"
			}
			else
			{
				document.getElementById("greenBoxComputer").style.display = "block";
			}
		}
		
		function replaceTags(html){
			$('#tags').replaceWith($(html));
		}
		
		$('button[name="addTag"]').click(function(event){
			var data = $('form').serialize();
			$.post('/add_tag', data, replaceTags);
			document.getElementById("tag").value="";
			return false;
		});
	</script>
	</div>
	
	</body>
</html>